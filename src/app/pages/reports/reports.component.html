<!-- Common Header -->
<app-common-header></app-common-header>

<div class="reports-container">
  <!-- Header Section -->
  <div class="reports-header">
    <div class="header-content">
      <div class="header-left">
        <button type="button" class="back-button" routerLink="/survey-dashboard">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Back to Dashboard
        </button>
        <div class="welcome-section">
          <h1 class="welcome-title">Reports</h1>
          <p class="welcome-subtitle">Tamil Nadu Government - Survey Reports & Analytics</p>
        </div>
      </div>
      <button type="button" class="logout-button" (click)="onLogout()">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="16,17 21,12 16,7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Logout
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="reports-content">
    <!-- Reports Cards -->
    <div class="reports-cards">
      <div class="report-card survey-report" (click)="onSurveyReport()">
        <div class="card-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="16" y1="13" x2="8" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="16" y1="17" x2="8" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="card-content">
          <h3>Survey Report</h3>
          <p>Generate comprehensive survey reports with detailed analytics and insights</p>
          <div class="card-stats">
            <span class="stat-item">Total Surveys: 1,250</span>
            <span class="stat-item">Completion Rate: 78%</span>
          </div>
        </div>
        <div class="card-arrow">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 12H19M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>

      <div class="report-card misreport" (click)="onMisreport()">
        <div class="card-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="card-content">
          <h3>Misreport</h3>
          <p>View and manage misreported data with correction and validation tools</p>
          <div class="card-stats">
            <span class="stat-item">Pending Reviews: 45</span>
            <span class="stat-item">Resolved: 89%</span>
          </div>
        </div>
        <div class="card-arrow">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 12H19M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
    </div>

    <!-- Completed Survey List -->
    <div class="completed-survey-section">
      <div class="section-header">
        <h3>Completed Survey List</h3>
        <div class="header-actions">
          <button type="button" class="filter-toggle-btn" (click)="toggleFilters()" [class.active]="showFilters">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46 22,3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Filters
          </button>
          <button type="button" class="export-btn" (click)="onExportData()">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Export
          </button>
        </div>
      </div>

      <!-- Filter Panel -->
      <div class="filter-panel" [class.show]="showFilters">
        <div class="filter-row">
          <div class="filter-group">
            <label for="district">District</label>
            <select id="district" [(ngModel)]="filters.districtId" (change)="onDistrictChange()" class="form-control">
              <option value="">All Districts</option>
              <option *ngFor="let district of districts" [value]="district.id">{{ district.name }}</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="block">Block</label>
            <select id="block" [(ngModel)]="filters.blockId" class="form-control" [disabled]="!filters.districtId">
              <option value="">All Blocks</option>
              <option *ngFor="let block of blocks" [value]="block.blockId">{{ block.blockName }}</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="fromDate">From Date</label>
            <input type="date" id="fromDate" [(ngModel)]="filters.fromDate" class="form-control">
          </div>
          <div class="filter-group">
            <label for="toDate">To Date</label>
            <input type="date" id="toDate" [(ngModel)]="filters.toDate" class="form-control">
          </div>
          <div class="filter-actions">
            <button type="button" class="btn btn-primary" (click)="applyFilters()">Apply</button>
            <button type="button" class="btn btn-secondary" (click)="clearFilters()">Clear</button>
          </div>
        </div>
      </div>

      <!-- Data Table -->
      <div class="table-container">
        <div class="table-responsive">
          <table class="data-table">
            <thead>
              <tr>
                <th *ngFor="let col of tableColumns">{{ col.header }}</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of tableData; let i = index">
                <td *ngFor="let col of tableColumns">{{ row[col.field] }}</td>
              </tr>
              <tr *ngIf="tableData.length === 0">
                <td [attr.colspan]="tableColumns.length" class="no-data">No data available</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" *ngIf="totalRecords > 0">
          <div class="pagination-info">
            Showing {{ ((currentPage - 1) * pageSize) + 1 }} to {{ Math.min(currentPage * pageSize, totalRecords) }} of {{ totalRecords }} entries
          </div>
          <div class="pagination-controls">
            <button type="button" class="btn btn-sm" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
              Previous
            </button>
            <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
            <button type="button" class="btn btn-sm" [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
