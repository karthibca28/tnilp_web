<!-- Common Header -->
<app-common-header></app-common-header>

<div class="survey-users-container">

  <!-- Main Content -->
  <div class="users-content">
    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb-section" *ngIf="selectedDistrict">
      <div class="breadcrumb">
        <a routerLink="/survey-dashboard" class="breadcrumb-link">Dashboard</a>
        <span class="breadcrumb-separator">></span>
        <span class="breadcrumb-current">{{ selectedDistrict.name }} District</span>
      </div>
    </div>

    <!-- Quick Navigation Section -->
    <div class="quick-nav-section" *ngIf="selectedDistrict">
      <div class="quick-nav-card">
        <h4>Quick Navigation</h4>
        <div class="nav-buttons">
          <button type="button" class="nav-btn" routerLink="/survey-dashboard">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="9,22 9,12 15,12 15,22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Dashboard
          </button>
          <button type="button" class="nav-btn" routerLink="/survey-results">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2h-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9 11V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Survey Results
          </button>
          <button type="button" class="nav-btn" (click)="onRefreshData()">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 4V10H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M23 20V14H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10M23 14L18.36 18.36A9 9 0 0 1 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Refresh Data
          </button>
        </div>
      </div>
    </div>

    <!-- User Details Section -->
    <div class="user-section">
      <div class="user-card">
        <div class="user-header">
          <div class="header-left">
            <h3>{{ selectedDistrict ? selectedDistrict.name + ' District - Block-wise Users' : 'Survey Users' }}</h3>
            <p class="breadcrumb" *ngIf="selectedDistrict">
              <a routerLink="/survey-dashboard" class="breadcrumb-link">Dashboard</a> 
              <span class="breadcrumb-separator">></span> 
              <span class="breadcrumb-current">{{ selectedDistrict.name }}</span>
            </p>
          </div>
          <div class="user-filters">
            <div class="filter-group">
              <select [(ngModel)]="selectedUserLevel" (change)="onFilterChange()" class="filter-select">
                <option value="">All User Levels</option>
                <option value="primary">Primary</option>
                <option value="secondary">Secondary</option>
              </select>
              <select [(ngModel)]="selectedBlock" (change)="onFilterChange()" class="filter-select" *ngIf="selectedDistrict">
                <option value="">All Blocks</option>
                <option *ngFor="let block of availableBlocks" [value]="block">{{ block }}</option>
              </select>
            </div>
            <button type="button" class="refresh-btn" (click)="loadUsers()">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 4V10H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M23 20V14H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10M23 14L18.36 18.36A9 9 0 0 1 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span class="refresh-text">Refresh</span>
            </button>
          </div>
        </div>
        <div class="user-content">
          <div class="user-stats">
            <div class="stat-item">
              <span class="stat-value">{{ totalUsers }}</span>
              <span class="stat-label">Total Users</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{ activeUsers }}</span>
              <span class="stat-label">Active Users</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{ totalTarget }}</span>
              <span class="stat-label">Total Target</span>
            </div>
          </div>
          <div class="user-table-container">
            <table class="user-table">
              <thead>
                <tr>
                  <th>S.No</th>
                  <th>Name</th>
                  <th>Mobile</th>
                  <th>Email</th>
                  <th>District</th>
                  <th>Block</th>
                  <th>Panchayat</th>
                  <th>User Level</th>
                  <th>Target</th>
                  <th>Last Login</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of users; let i = index">
                  <td>{{ user.sno }}</td>
                  <td class="user-name">{{ user.name }}</td>
                  <td>{{ user.mobile }}</td>
                  <td>{{ user.email || '-' }}</td>
                  <td>{{ user.district }}</td>
                  <td>{{ user.block }}</td>
                  <td>{{ user.panchayat }}</td>
                  <td>
                    <span class="user-level" [class]="'level-' + user.userLevel">
                      {{ user.userLevel }}
                    </span>
                  </td>
                  <td>{{ user.target }}</td>
                  <td>{{ user.lastLogin || 'Never' }}</td>
                  <td>
                    <span class="status-badge" [class]="user.isActive === '1' ? 'active' : 'inactive'">
                      {{ user.isActive === '1' ? 'Active' : 'Inactive' }}
                    </span>
                  </td>
                  <td class="actions-cell">
                    <div class="action-buttons">
                      <button type="button" class="action-btn view-btn" (click)="onViewUser(user)" title="View Details">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                      <button type="button" class="action-btn edit-btn" (click)="onEditUser(user)" title="Edit User">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                      <button type="button" class="action-btn survey-btn" (click)="onViewUserSurveys(user)" title="View Surveys">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M9 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2h-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M9 11V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M9 7h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>